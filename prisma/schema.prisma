// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}


datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id String @id @default(auto()) @map("_id") @db.ObjectId
   clerkId String @unique
  email String @unique 
  name String?
  avatar    String?
  createdAt DateTime @default(now())
    friends   Friends[]      @relation("User_Friends_asOwner")
 
  friendOf  Friends[]      @relation("User_Friends_asFriend")
  sentRequests     RequestTable[] @relation("SenderRequests")
  receivedRequests RequestTable[] @relation("ReceiverRequests")
notificationsSent     Notifications[] @relation("NotificationsSent")
notificationsReceived Notifications[] @relation("NotificationsReceived")
}

model Friends{
  id String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  friendId String @db.ObjectId
  streaks Int @default(0)
  lastsnapat DateTime?
  createdAt DateTime @default(now())
  
 user   User @relation("User_Friends_asOwner",  fields: [userId],   references: [id])
  friend User @relation("User_Friends_asFriend", fields: [friendId], references: [id])
  @@unique([userId, friendId])
}
model RequestTable{
  id String @id @default(auto()) @map("_id") @db.ObjectId
  senderid String @db.ObjectId
  receiverid String @db.ObjectId
  createdAt DateTime @default(now())
  status statusEnum @default(PENDING)
   sender   User @relation("SenderRequests",   fields: [senderid],   references: [id])
  receiver User @relation("ReceiverRequests", fields: [receiverid], references: [id])
}
enum statusEnum{
  PENDING
  ACCEPTED  
  REJECTED
}

model messages{
  id String @id @default(auto()) @map("_id") @db.ObjectId
  senderid String
  receiverid String
  roomid String
  text String?
  mediaurl String?
  type msgtype
  isopened  Boolean @default(false)
  expiresAt DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
enum msgtype{
  TEXT
  SNAP
  IMAGE
  VIDEO
}

model Notifications{
  id String @id @default(auto()) @map("_id") @db.ObjectId
   senderid String @db.ObjectId
  receiverid String @db.ObjectId
  roomid String?
  message String?
  messageid String?
  isopened Boolean @default(false)
  sender User @relation("NotificationsSent",fields: [senderid],references: [id])
  receiver User @relation("NotificationsReceived",fields: [receiverid],references: [id])
  createdAt DateTime @default(now())
  type notifyType
}

enum notifyType{
  FRIEND_REQUEST
  REQUEST_ACCEPTED
  SNAP
  CHAT
}